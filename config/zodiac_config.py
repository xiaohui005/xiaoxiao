# 生肖对应号码配置
# 每年生肖向前移动一位，号码对应关系也会相应调整

ZODIAC_YEAR_MAPPING = {
    2023: {
        '兔': "1,13,25,37,49",
        '龙': "12,24,36,48", 
        '蛇': "11,23,35,47",
        '马': "10,22,34,46",
        '羊': "9,21,33,45",
        '猴': "8,20,32,44",
        '鸡': "7,19,31,43",
        '狗': "6,18,30,42",
        '猪': "5,17,29,41",
        '鼠': "4,16,28,40",
        '牛': "3,15,27,39",
        '虎': "2,14,26,38"
    },
    2024: {
        '龙': "1,13,25,37,49",
        '蛇': "12,24,36,48",
        '马': "11,23,35,47", 
        '羊': "10,22,34,46",
        '猴': "9,21,33,45",
        '鸡': "8,20,32,44",
        '狗': "7,19,31,43",
        '猪': "6,18,30,42",
        '鼠': "5,17,29,41",
        '牛': "4,16,28,40",
        '虎': "3,15,27,39",
        '兔': "2,14,26,38"
    },
    2025: {
        '蛇': "1,13,25,37,49",
        '马': "12,24,36,48",
        '羊': "11,23,35,47",
        '猴': "10,22,34,46",
        '鸡': "9,21,33,45",
        '狗': "8,20,32,44",
        '猪': "7,19,31,43",
        '鼠': "6,18,30,42",
        '牛': "5,17,29,41",
        '虎': "4,16,28,40",
        '兔': "3,15,27,39",
        '龙': "2,14,26,38"
    },
    2026: {
        '马': "1,13,25,37,49",
        '羊': "12,24,36,48",
        '猴': "11,23,35,47",
        '鸡': "10,22,34,46",
        '狗': "9,21,33,45",
        '猪': "8,20,32,44",
        '鼠': "7,19,31,43",
        '牛': "6,18,30,42",
        '虎': "5,17,29,41",
        '兔': "4,16,28,40",
        '龙': "3,15,27,39",
        '蛇': "2,14,26,38"
    },
    2027: {
        '羊': "1,13,25,37,49",
        '猴': "12,24,36,48",
        '鸡': "11,23,35,47",
        '狗': "10,22,34,46",
        '猪': "9,21,33,45",
        '鼠': "8,20,32,44",
        '牛': "7,19,31,43",
        '虎': "6,18,30,42",
        '兔': "5,17,29,41",
        '龙': "4,16,28,40",
        '蛇': "3,15,27,39",
        '马': "2,14,26,38"
    },
    2028: {
        '猴': "1,13,25,37,49",
        '鸡': "12,24,36,48",
        '狗': "11,23,35,47",
        '猪': "10,22,34,46",
        '鼠': "9,21,33,45",
        '牛': "8,20,32,44",
        '虎': "7,19,31,43",
        '兔': "6,18,30,42",
        '龙': "5,17,29,41",
        '蛇': "4,16,28,40",
        '马': "3,15,27,39",
        '羊': "2,14,26,38"
    },
    2029: {
        '鸡': "1,13,25,37,49",
        '狗': "12,24,36,48",
        '猪': "11,23,35,47",
        '鼠': "10,22,34,46",
        '牛': "9,21,33,45",
        '虎': "8,20,32,44",
        '兔': "7,19,31,43",
        '龙': "6,18,30,42",
        '蛇': "5,17,29,41",
        '马': "4,16,28,40",
        '羊': "3,15,27,39",
        '猴': "2,14,26,38"
    },
    2030: {
        '狗': "1,13,25,37,49",
        '猪': "12,24,36,48",
        '鼠': "11,23,35,47",
        '牛': "10,22,34,46",
        '虎': "9,21,33,45",
        '兔': "8,20,32,44",
        '龙': "7,19,31,43",
        '蛇': "6,18,30,42",
        '马': "5,17,29,41",
        '羊': "4,16,28,40",
        '猴': "3,15,27,39",
        '鸡': "2,14,26,38"
    },
    2031: {
        '猪': "1,13,25,37,49",
        '鼠': "12,24,36,48",
        '牛': "11,23,35,47",
        '虎': "10,22,34,46",
        '兔': "9,21,33,45",
        '龙': "8,20,32,44",
        '蛇': "7,19,31,43",
        '马': "6,18,30,42",
        '羊': "5,17,29,41",
        '猴': "4,16,28,40",
        '鸡': "3,15,27,39",
        '狗': "2,14,26,38"
    },
    2032: {
        '鼠': "1,13,25,37,49",
        '牛': "12,24,36,48",
        '虎': "11,23,35,47",
        '兔': "10,22,34,46",
        '龙': "9,21,33,45",
        '蛇': "8,20,32,44",
        '马': "7,19,31,43",
        '羊': "6,18,30,42",
        '猴': "5,17,29,41",
        '鸡': "4,16,28,40",
        '狗': "3,15,27,39",
        '猪': "2,14,26,38"
    }
}

def get_zodiac_numbers_by_year(year, zodiac):
    """
    根据年份和生肖获取对应的号码列表
    
    Args:
        year (int): 年份
        zodiac (str): 生肖名称
    
    Returns:
        list: 号码列表
    """
    if year not in ZODIAC_YEAR_MAPPING:
        return []
    
    if zodiac not in ZODIAC_YEAR_MAPPING[year]:
        return []
    
    numbers_str = ZODIAC_YEAR_MAPPING[year][zodiac]
    return [int(x.strip()) for x in numbers_str.split(',')]

def get_zodiac_by_number_and_year(number, year):
    """
    根据号码和年份获取对应的生肖
    
    Args:
        number (int): 号码
        year (int): 年份
    
    Returns:
        str: 生肖名称，如果没找到返回空字符串
    """
    if year not in ZODIAC_YEAR_MAPPING:
        return ""
    
    for zodiac, numbers_str in ZODIAC_YEAR_MAPPING[year].items():
        numbers = [int(x.strip()) for x in numbers_str.split(',')]
        if number in numbers:
            return zodiac
    
    return ""

def get_zodiac_by_number_and_lunar_date(number, draw_time):
    """
    根据开奖号码和开奖新历日期，先转农历年，再查生肖
    Args:
        number (int): 号码
        draw_time (str): 开奖时间字符串 'YYYY-MM-DD' 或 'YYYY-MM-DD HH:MM:SS'
    Returns:
        str: 生肖名称，如果没找到返回空字符串
    """
    try:
        from common.lottery_analyzer import solar_to_lunar
    except ImportError:
        def solar_to_lunar(date_str):
            print('solar_to_lunar not available')
            return None
    lunar = solar_to_lunar(draw_time)
    if not lunar:
        return ''
    lunar_year = lunar['year']
    return get_zodiac_by_number_and_year(number, lunar_year)

def get_available_years():
    """
    获取可用的年份列表
    
    Returns:
        list: 年份列表
    """
    return sorted(ZODIAC_YEAR_MAPPING.keys())

def get_available_zodiacs():
    """
    获取所有生肖列表
    
    Returns:
        list: 生肖列表
    """
    return ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪'] 